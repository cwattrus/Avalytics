.dropdown
  %a.dropdown-toggle{"data-toggle" => "dropdown", :href => "#"}
    Select a job title to filter
  %ul.dropdown-menu{:role => "menu", "aria-labelledby" => "dLabel"}
    %li
      %a.job{:href => "#", :tabindex => "-1", :onClick => "update_chart(base_url)"}
        All jobs
    - @job_lists.each do |job_list|
      %li
        %a.job{:href => "#", :tabindex => "-1", :onClick => "update_chart(base_url+'?job_title=#{job_list.job_title}')"}
          = job_list.job_title

:css
  #chart svg {
    height: 400px;
  }

#chart
  %svg

:javascript
  var base_url = '/data/gender_pie.json';
  $(".dropdown-toggle").dropdown();
  var update_chart = function(url){
    $.getJSON(url, function(data){
      nv.addGraph(function() {
        var chart = nv.models.pieChart()
            .x(function(d) { return d.label })
            .y(function(d) { return d.value })
            .showLabels(true)
            .width(400)
            .height(400)
            .color(["#EE7722", "#99BBBB", "#666677"])
            .tooltipContent(function(key, y, e, graph) {
              return '<div class="btn-group"><div class="btn"><h5>' + key + '</h5></div>' +
                     '<div class="btn">' +  parseInt(y,10) + '</div></div>'
            });

          d3.select("#chart svg")
              .datum(data)
              .transition().duration(1200)
              .call(chart);

        return chart;
      });
    });
  };
  update_chart(base_url);