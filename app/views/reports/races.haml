.container
  .row
    .span1
      .lead.pull-right
        Filters:
    .span8
      .dropdown
        %a.btn.dropdown-toggle{"data-toggle" => "dropdown", :href => "#"}
          Select a job title to filter
        %ul.dropdown-menu{:role => "menu", "aria-labelledby" => "dLabel"}
          %li
            %a.job{:href => "#", :tabindex => "-1", :onClick => "update_chart(base_url)"}
              All jobs
          - @job_lists.each do |job_list|
            %li
              %a.job{:href => "#", :tabindex => "-1", :onClick => "update_chart(base_url+'?job_title=#{job_list.job_title}')"}
                = job_list.job_title

:css
  #chart svg {
    height: 400px;
  }

#chart
  %svg

:javascript
  var base_url = '/data/race_pie.json';
  $(".dropdown-toggle").dropdown();
  var update_chart = function(url){
    $.getJSON(url, function(data){
      nv.addGraph(function() {
        var chart = nv.models.pieChart()
            .x(function(d) { return d.label })
            .y(function(d) { return d.value })
            .showLabels(true)
            .width(400)
            .height(400)
            .color(["#c06040", "#e0c080", "#a0a0a0", "#808040", "#e0f0f0", "#e0e0a0", "#806040", "#606040"])
            .tooltipContent(function(key, y, e, graph) {
              return '<div class="popover-title"><div class="lead">' + key + '</div>' +
                     '<div class="lead"><strong>' +  parseInt(y,10) + '</strong></div></div>'
            });

          d3.select("#chart svg")
              .datum(data)
              .transition().duration(1200)
              .call(chart);

        return chart;
      });
    });
  };
  update_chart(base_url);